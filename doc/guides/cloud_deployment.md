# Инструкция по ручному развертыванию в Railway

В этом руководстве описан процесс ручного развертывания LLM-ассистента для Telegram в облачном сервисе Railway с использованием Docker.

## О Railway

Railway — это современная платформа для развертывания приложений, которая позволяет быстро и легко запускать контейнеры Docker в облаке.

**Преимущества Railway:**
- Простой интерфейс для ручного развертывания
- Бесплатный тариф: $5 кредитов в месяц (примерно 500 часов работы)
- Встроенная поддержка переменных окружения
- Поддержка Docker из коробки
- Удобный мониторинг и логирование

## Предварительные требования

1. Аккаунт на [Railway](https://railway.app/)
2. Токен Telegram бота и API ключ OpenRouter
3. Локальный Docker-образ приложения

## Шаги ручного развертывания

### 1. Подготовка Docker-образа

1. Убедитесь, что у вас есть собранный Docker-образ:
   ```
   make docker-build
   ```

2. Проверьте наличие образа:
   ```
   docker images
   ```
   Вы должны увидеть образ `telegram-llm-assistant` в списке.

### 2. Создание аккаунта Railway

1. Перейдите на [Railway](https://railway.app/) и зарегистрируйтесь
2. Подтвердите email и войдите в аккаунт

### 3. Создание нового проекта

1. На главной странице Railway нажмите "New Project"
2. Выберите "Deploy from Dockerfile" (не GitHub)

### 4. Настройка проекта

1. Загрузите Dockerfile из вашего проекта
   - Нажмите "Upload Dockerfile"
   - Выберите файл Dockerfile из вашего проекта

2. Настройте имя сервиса:
   - Введите "telegram-llm-assistant" в поле "Service Name"

3. Настройте переменные окружения:
   - Нажмите на вкладку "Variables"
   - Добавьте следующие переменные:
     - `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота
     - `OPENROUTER_API_KEY` - ваш API ключ OpenRouter

4. Настройте ресурсы:
   - Нажмите на вкладку "Settings"
   - В разделе "Resources" выберите минимальную конфигурацию:
     - 256MB RAM
     - 0.1 vCPU
   - Это позволит максимально эффективно использовать бесплатный тариф

### 5. Запуск развертывания

1. Нажмите кнопку "Deploy" в верхнем правом углу
2. Дождитесь завершения процесса сборки и развертывания
3. После успешного развертывания вы увидите статус "Deployment successful"

### 6. Проверка работы бота

1. Откройте Telegram и найдите своего бота
2. Отправьте ему сообщение
3. Убедитесь, что бот отвечает корректно

### 7. Мониторинг и управление

1. Просмотр логов:
   - На странице проекта нажмите на вкладку "Logs"
   - Здесь вы увидите все логи вашего приложения в реальном времени

2. Мониторинг использования ресурсов:
   - На странице проекта нажмите на вкладку "Metrics"
   - Здесь доступны графики использования CPU, памяти и сети

3. Управление состоянием:
   - Для перезапуска: нажмите кнопку "Restart"
   - Для остановки: нажмите кнопку "Stop"
   - Для удаления: перейдите в Settings -> Danger Zone -> Delete Service

### 8. Управление расходами

1. Мониторинг использования бесплатного тарифа:
   - Перейдите в раздел "Billing" в левом меню
   - Здесь вы увидите текущее использование кредитов и оставшееся время

2. Оптимизация расходов:
   - Когда бот не используется, остановите его через кнопку "Stop"
   - Это позволит сэкономить кредиты бесплатного тарифа

## Устранение неполадок

1. **Ошибка сборки**
   - Проверьте логи сборки
   - Убедитесь, что Dockerfile корректен
   - Проверьте, что все необходимые файлы присутствуют в проекте

2. **Бот не отвечает**
   - Проверьте логи на наличие ошибок
   - Убедитесь, что переменные окружения установлены правильно
   - Проверьте статус сервиса в Railway

3. **Превышение лимитов бесплатного тарифа**
   - Railway уведомит вас по email
   - Можно временно остановить сервис или перейти на платный тариф